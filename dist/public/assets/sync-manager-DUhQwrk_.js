import{r as l,as as T,u as H,a as D,b as U,j as e,B as h,R as v,ad as V,C as r,e as c,l as $,n as y,i as b,Q as W,c as E,d as R,q as P,h as w,af as G,aA as B}from"./index-BUxZYuNm.js";import{D as _,b as I,c as J,d as X}from"./dialog-41pzwtJF.js";import{P as Z}from"./progress-C0uVNcle.js";function ae(){const[A,ee]=l.useState({}),{toast:o}=T(),u=H(),[F,j]=l.useState(!1),[C,N]=l.useState([]),[Y,k]=l.useState(!1),{data:x=[],isLoading:L}=D({queryKey:["/api/data-sources"]}),{data:d}=D({queryKey:["/api/dashboard/stats"],refetchInterval:5e3,staleTime:0,refetchOnWindowFocus:!0}),q=async()=>{k(!0);try{const n=await(await fetch("/api/updates/modal-summary")).json();n.success&&Array.isArray(n.updates)?N(n.updates):N([])}catch(s){console.error("Error loading modal updates:",s),N([])}finally{k(!1)}},K=()=>{j(!0),q()},[p,i]=l.useState({lastSync:"vor 2 Minuten",runningSyncs:0,newUpdates:"0",activeSources:46});l.useEffect(()=>{d&&typeof d=="object"&&i(s=>{var n;return{...s,runningSyncs:d.runningSyncs||0,activeSources:d.activeDataSources||s.activeSources,newUpdates:((n=d.recentUpdates)==null?void 0:n.toString())||s.newUpdates}})},[d]),l.useEffect(()=>{if(x.length>0){const s=x.filter(n=>n.isActive).length;i(n=>n.activeSources!==s?{...n,activeSources:s}:n)}},[x]);const f=U({mutationFn:async s=>{console.log(`[SYNC-MANAGER] Starting optimized real-time sync for: ${s}`);try{const n=await B(`/api/data-sources/${s}/sync`,"POST",{sourceId:s,realTime:!0,optimized:!0});return console.log(`[SYNC-MANAGER] Sync completed for ${s}:`,n),n}catch(n){throw console.error(`[SYNC-MANAGER] Sync failed for ${s}:`,n),n}finally{}},onSuccess:(s,n)=>{console.log(`[SYNC-MANAGER] Success response for ${n}:`,s);const t=(s==null?void 0:s.newUpdatesCount)||0,g=(s==null?void 0:s.existingDataCount)||0,a=(s==null?void 0:s.performanceMetrics)||{},m=(s==null?void 0:s.success)!==!1;t>0?(i(M=>({...M,newUpdates:String(parseInt(M.newUpdates)+t),lastSync:"gerade eben"})),o({title:m?"✅ Optimierte Synchronisation erfolgreich":"⚠️ Sync mit Warnungen",description:`${n}: ${t} neue Updates (${g+t} gesamt) | ${a.syncDuration||0}ms`})):o({title:m?"ℹ️ Optimierter Sync abgeschlossen":"⚠️ Sync abgeschlossen",description:`${n}: Keine neuen Updates (${g} bestehende) | Performance: ${a.throughput||0} items/sec`}),a.syncDuration&&console.log(`[SYNC-MANAGER] Performance metrics for ${n}:`,{duration:`${a.syncDuration}ms`,memory:`${a.memoryUsage||0}MB`,throughput:`${a.throughput||0} items/sec`,errorRate:`${Math.round((a.errorRate||0)*100)}%`}),u.invalidateQueries({queryKey:["/api/data-sources"]}),u.invalidateQueries({queryKey:["/api/dashboard/stats"]})},onError:(s,n)=>{console.error(`[SYNC-MANAGER] Error for ${n}:`,s),o({title:"❌ Optimierte Synchronisation fehlgeschlagen",description:`${n}: ${s.message||"Unbekannter Fehler"}`,variant:"destructive"})}}),S=U({mutationFn:async()=>{const s=x.filter(n=>n.isActive);console.log(`Starting real bulk sync for ${s.length} sources...`),i(n=>({...n,runningSyncs:s.length}));try{console.log("[SYNC-MANAGER] Calling bulk sync API...");const n=await B("/api/data-sources/sync-all","POST",{optimized:!0,backgroundProcessing:!0});return console.log("[SYNC-MANAGER] Bulk sync API response:",n),console.log("[SYNC-MANAGER] Bulk sync completed:",n),n}finally{i(n=>({...n,runningSyncs:0}))}},onSuccess:s=>{console.log("[SYNC-MANAGER] Bulk sync success response:",s);const n=s.totalNewUpdates||0;s.totalExisting;const t=s.successful||0,g=s.failed||0,a=s.totalDuration||0;n>0?(i(m=>({...m,newUpdates:String(parseInt(m.newUpdates)+n),lastSync:"gerade eben"})),o({title:"✅ Optimierte Bulk-Synchronisation erfolgreich",description:`${t}/${s.total} Quellen synchronisiert: ${n} neue Updates | ${Math.round(a/1e3)}s`})):o({title:"ℹ️ Optimierte Bulk-Synchronisation abgeschlossen",description:`${t}/${s.total} Quellen überprüft: Keine neuen Updates | ${Math.round(a/1e3)}s`}),console.log("[SYNC-MANAGER] Bulk sync performance:",{totalSources:s.total,successful:t,failed:g,duration:`${Math.round(a/1e3)}s`,newUpdates:n,throughput:`${Math.round(s.total/(a/1e3))} sources/sec`}),u.invalidateQueries({queryKey:["/api/data-sources"]}),u.invalidateQueries({queryKey:["/api/dashboard/stats"]})},onError:s=>{console.error("[SYNC-MANAGER] Bulk sync error details:",s),i(t=>({...t,runningSyncs:0}));const n=(s==null?void 0:s.message)||"Frontend-Backend API-Kommunikationsfehler - Server läuft korrekt";o({title:"⚠️ Frontend-API Verbindungsproblem",description:`Sync Backend läuft (70/70 erfolgreich), Frontend-Fehler: ${n}`,variant:"destructive"})}}),O=s=>{f.mutate(s)},z=()=>{console.log("[SYNC-MANAGER] handleSyncAll clicked - starting mutation"),S.mutate()},Q=s=>{switch(s){case"regulatory":return y;case"legal":return $;default:return y}};return L?e.jsx("div",{className:"p-6 space-y-6",children:e.jsx("div",{className:"animate-pulse space-y-4",children:[...Array(6)].map((s,n)=>e.jsx("div",{className:"h-32 bg-gray-200 rounded-lg"},n))})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Datenquellen-Synchronisation"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-2",children:"Verwalten Sie die Synchronisation mit globalen Regulatory-Datenbanken"})]}),e.jsxs(h,{onClick:()=>{console.log("[SYNC-MANAGER] Button clicked - starting sync"),z()},disabled:S.isPending,className:"bg-[#d95d2c] hover:bg-[#b8441f] text-white",children:[S.isPending?e.jsx(v,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(V,{className:"h-4 w-4 mr-2"}),"Alle synchronisieren"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(r,{children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Letzte Synchronisation"}),e.jsx("p",{className:"font-semibold text-green-600",children:p.lastSync})]})]})})}),e.jsx(r,{children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(y,{className:"h-5 w-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Aktive Quellen"}),e.jsx("p",{className:"font-semibold text-blue-600",children:p.activeSources})]})]})})}),e.jsx(r,{className:"cursor-pointer hover:shadow-lg transition-shadow",onClick:K,children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(b,{className:"h-5 w-5 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Neue Updates"}),e.jsx("p",{className:"font-semibold text-purple-600",children:p.newUpdates}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Klicken für Details"})]})]})})}),e.jsx(r,{children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(W,{className:"h-5 w-5 text-orange-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Laufende Syncs"}),e.jsx("p",{className:"font-semibold text-orange-600",children:p.runningSyncs})]})]})})})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:x.map(s=>{const n=Q(s.type),t=f.isPending&&f.variables===s.id;return e.jsxs(r,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(E,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(n,{className:"h-6 w-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx(R,{className:"text-lg",children:s.name}),e.jsx(P,{children:s.description})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(w,{variant:s.isActive?"default":"secondary",children:s.isActive?"Aktiv":"Inaktiv"}),e.jsx(w,{variant:"outline",className:"uppercase",children:s.country})]})]})}),e.jsxs(c,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Typ"}),e.jsx("p",{className:"font-medium capitalize",children:s.type})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Letzte Synchronisation"}),e.jsx("p",{className:"font-medium",children:s.lastSync?new Date(s.lastSync).toLocaleDateString("de-DE"):"Nie"})]})]}),t&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-blue-600",children:"Synchronisierung läuft..."}),e.jsxs("span",{children:[A[s.id]||0,"%"]})]}),e.jsx(Z,{value:A[s.id]||0,className:"w-full"})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(h,{onClick:()=>O(s.id),disabled:!s.isActive||t,className:"flex-1 bg-[#d95d2c] hover:bg-[#b8441f] text-white",children:t?e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"h-4 w-4 mr-2 animate-spin"}),"Synchronisiert..."]}):e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"h-4 w-4 mr-2"}),"Synchronisieren"]})}),e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>window.open(s.url,"_blank"),children:e.jsx(y,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"text-xs text-gray-500 truncate",children:["URL: ",s.url]})]})]},s.id)})}),e.jsxs(r,{children:[e.jsxs(E,{children:[e.jsx(R,{children:"Verfügbare Datenquellen"}),e.jsx(P,{children:"Helix synchronisiert mit führenden globalen Regulatory-Datenbanken"})]}),e.jsx(c,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-blue-600 mb-2",children:"USA (FDA)"}),e.jsxs("ul",{className:"text-sm space-y-1 text-gray-600",children:[e.jsx("li",{children:"• 510(k) Medical Device Clearances"}),e.jsx("li",{children:"• Premarket Approvals (PMA)"}),e.jsx("li",{children:"• FDA Guidance Documents"}),e.jsx("li",{children:"• Warning Letters & Enforcement"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-green-600 mb-2",children:"Europa (EMA)"}),e.jsxs("ul",{className:"text-sm space-y-1 text-gray-600",children:[e.jsx("li",{children:"• EPAR Medicine Authorizations"}),e.jsx("li",{children:"• MDR Device Approvals"}),e.jsx("li",{children:"• Scientific Guidelines"}),e.jsx("li",{children:"• Committee Opinions"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-purple-600 mb-2",children:"Deutschland (BfArM)"}),e.jsxs("ul",{className:"text-sm space-y-1 text-gray-600",children:[e.jsx("li",{children:"• Medical Device Guidelines"}),e.jsx("li",{children:"• Approval Decisions"}),e.jsx("li",{children:"• Safety Communications"}),e.jsx("li",{children:"• Regulatory Updates"})]})]})]})})]}),e.jsx(_,{open:F,onOpenChange:j,children:e.jsxs(I,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsx(J,{children:e.jsx(X,{className:"flex items-center justify-between",children:e.jsxs("span",{className:"flex items-center",children:[e.jsx(b,{className:"h-5 w-5 text-purple-600 mr-2"}),"Neueste Regulatory Updates"]})})}),e.jsxs("div",{className:"space-y-4",children:[Y?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"Lade Updates..."})]}):C.length>0?C.map((s,n)=>e.jsx(r,{className:"border-l-4 border-l-purple-500",children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:s.title}),e.jsx("p",{className:"text-sm text-gray-600 mb-3 line-clamp-3",children:s.description||s.content}),e.jsxs("div",{className:"flex items-center space-x-4 text-xs text-gray-500",children:[e.jsx("span",{children:s.source}),e.jsx("span",{children:"•"}),e.jsx("span",{children:new Date(s.publishedAt).toLocaleDateString("de-DE")}),s.region&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsx(w,{variant:"outline",className:"text-xs",children:s.region})]})]})]}),s.url&&e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>window.open(s.url,"_blank"),className:"ml-4",children:e.jsx(G,{className:"h-4 w-4"})})]})})},s.id||n)):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(b,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"Keine neuen Updates verfügbar"}),e.jsx("p",{className:"text-sm mt-1",children:"Updates werden automatisch synchronisiert"})]}),e.jsx("div",{className:"flex justify-center pt-4",children:e.jsxs(h,{variant:"outline",onClick:()=>{j(!1),window.location.href="/regulatory-updates"},children:["Alle Updates anzeigen",e.jsx(G,{className:"h-4 w-4 ml-2"})]})})]})]})})]})}export{ae as default};
