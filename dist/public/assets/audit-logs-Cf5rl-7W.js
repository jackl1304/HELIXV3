import{r as c,a as le,j as e,B as S,i as y,C as V,c as G,d as $,ah as ae,e as K,s as re,_ as C,q as ne,h as D,w as ie,F as M,K as q,n as ce,o as de,V as oe,l as me,bl as H,bm as xe,ay as he,E as ue,aa as je}from"./index-BUxZYuNm.js";import{S as b,a as f,b as p,c as E,d as l}from"./select-Dxhz2xZH.js";import{T as W,a as Q,b as T,c as r,d as Z,e as n}from"./table-BMiloUPu.js";import"./index-NLfbe9Ak.js";const w={USER_CREATED:"Benutzerverwaltung",USER_UPDATED:"Benutzerverwaltung",USER_DELETED:"Benutzerverwaltung",LOGIN_SUCCESS:"Authentifizierung",LOGIN_FAILED:"Authentifizierung",LOGOUT:"Authentifizierung",CONTENT_APPROVED:"Genehmigung",CONTENT_REJECTED:"Genehmigung",SETTINGS_UPDATED:"Systemkonfiguration",DATA_EXPORT:"Datenexport",DATA_IMPORT:"Datenimport",NEWSLETTER_SENT:"Newsletter",BACKUP_CREATED:"System",SYSTEM_RESTART:"System"},ge={low:"bg-blue-100 text-blue-800 border-blue-200",medium:"bg-yellow-100 text-yellow-800 border-yellow-200",high:"bg-orange-100 text-orange-800 border-orange-200",critical:"bg-red-100 text-red-800 border-red-200"},ve={success:"bg-green-100 text-green-800",failure:"bg-red-100 text-red-800"},Ne={USER_CREATED:je,USER_UPDATED:ue,USER_DELETED:he,LOGIN_SUCCESS:xe,LOGIN_FAILED:H,LOGOUT:H,CONTENT_APPROVED:me,CONTENT_REJECTED:oe,SETTINGS_UPDATED:q,DATA_EXPORT:y,DATA_IMPORT:y,NEWSLETTER_SENT:de,BACKUP_CREATED:ce,SYSTEM_RESTART:q};function Te(){const[x,k]=c.useState(""),[h,R]=c.useState("all"),[u,L]=c.useState("all"),[j,_]=c.useState("all"),[g,I]=c.useState("all"),[d,U]=c.useState(),[o,O]=c.useState(),[t,P]=c.useState(null),{data:v=[],isLoading:Se}=le({queryKey:["/api/audit-logs",{search:x,action:h==="all"?void 0:h,severity:u==="all"?void 0:u,status:j==="all"?void 0:j,user:g==="all"?void 0:g,dateFrom:d==null?void 0:d.toISOString(),dateTo:o==null?void 0:o.toISOString()}],enabled:!0}),N=v.filter(s=>{const m=x===""||s.details.toLowerCase().includes(x.toLowerCase())||s.userName.toLowerCase().includes(x.toLowerCase())||s.action.toLowerCase().includes(x.toLowerCase()),i=h==="all"||s.action===h,A=u==="all"||s.severity===u,a=j==="all"||s.status===j,ee=g==="all"||s.userId===g,F=new Date(s.timestamp),se=!d||F>=d,te=!o||F<=o;return m&&i&&A&&a&&ee&&se&&te}),J=Array.from(new Set(v.map(s=>s.action))),X=Array.from(new Set(v.map(s=>({id:s.userId,name:s.userName})))),z=s=>new Date(s).toLocaleDateString("de-DE",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}),B=s=>{const m=Ne[s]||M;return e.jsx(m,{className:"h-4 w-4"})},Y=()=>{const s=["Zeitstempel,Benutzer,Aktion,Resource,Details,Schweregrad,Status,IP-Adresse",...N.map(a=>`"${a.timestamp}","${a.userName}","${a.action}","${a.resource}","${a.details}","${a.severity}","${a.status}","${a.ipAddress}"`)].join(`
`),m=new Blob([s],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a"),A=URL.createObjectURL(m);i.setAttribute("href",A),i.setAttribute("download",`audit-logs-${new Date().toISOString().split("T")[0]}.csv`),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i)};return e.jsxs("div",{className:"container mx-auto py-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Audit-Protokolle"}),e.jsx("p",{className:"text-muted-foreground",children:"VollstÃ¤ndige Aufzeichnung aller SystemaktivitÃ¤ten und Ã„nderungen"})]}),e.jsxs(S,{onClick:Y,children:[e.jsx(y,{className:"mr-2 h-4 w-4"}),"Protokolle exportieren"]})]}),e.jsxs("div",{className:"grid gap-6",children:[e.jsxs(V,{children:[e.jsx(G,{children:e.jsxs($,{className:"flex items-center",children:[e.jsx(ae,{className:"mr-2 h-5 w-5"}),"Filter & Suche"]})}),e.jsxs(K,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Suche"}),e.jsxs("div",{className:"relative",children:[e.jsx(re,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(C,{placeholder:"Details, Benutzer, Aktion...",value:x,onChange:s=>k(s.target.value),className:"pl-10"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Aktion"}),e.jsxs(b,{value:h,onValueChange:R,children:[e.jsx(f,{children:e.jsx(p,{})}),e.jsxs(E,{children:[e.jsx(l,{value:"all",children:"Alle Aktionen"}),J.map(s=>e.jsx(l,{value:s,children:w[s]||s},s))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Schweregrad"}),e.jsxs(b,{value:u,onValueChange:L,children:[e.jsx(f,{children:e.jsx(p,{})}),e.jsxs(E,{children:[e.jsx(l,{value:"all",children:"Alle Schweregrade"}),e.jsx(l,{value:"critical",children:"ðŸ”´ Kritisch"}),e.jsx(l,{value:"high",children:"ðŸŸ  Hoch"}),e.jsx(l,{value:"medium",children:"ðŸŸ¡ Mittel"}),e.jsx(l,{value:"low",children:"ðŸ”µ Niedrig"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Status"}),e.jsxs(b,{value:j,onValueChange:_,children:[e.jsx(f,{children:e.jsx(p,{})}),e.jsxs(E,{children:[e.jsx(l,{value:"all",children:"Alle Status"}),e.jsx(l,{value:"success",children:"âœ… Erfolgreich"}),e.jsx(l,{value:"failure",children:"âŒ Fehlgeschlagen"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Benutzer"}),e.jsxs(b,{value:g,onValueChange:I,children:[e.jsx(f,{children:e.jsx(p,{})}),e.jsxs(E,{children:[e.jsx(l,{value:"all",children:"Alle Benutzer"}),X.map(s=>e.jsx(l,{value:s.id,children:s.name},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Von Datum"}),e.jsx(C,{type:"date",value:d?d.toISOString().split("T")[0]:"",onChange:s=>U(s.target.value?new Date(s.target.value):void 0)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Bis Datum"}),e.jsx(C,{type:"date",value:o?o.toISOString().split("T")[0]:"",onChange:s=>O(s.target.value?new Date(s.target.value):void 0)})]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:[N.length," von ",v.length," EintrÃ¤gen gefunden"]}),e.jsx(S,{variant:"outline",onClick:()=>{k(""),R("all"),L("all"),_("all"),I("all"),U(void 0),O(void 0)},children:"Filter zurÃ¼cksetzen"})]})]})]}),e.jsxs(V,{children:[e.jsxs(G,{children:[e.jsx($,{children:"SystemaktivitÃ¤ten"}),e.jsx(ne,{children:"Chronologische Auflistung aller wichtigen Systemereignisse"})]}),e.jsxs(K,{children:[e.jsxs(W,{children:[e.jsx(Q,{children:e.jsxs(T,{children:[e.jsx(r,{children:"Zeitstempel"}),e.jsx(r,{children:"Benutzer"}),e.jsx(r,{children:"Aktion"}),e.jsx(r,{children:"Resource"}),e.jsx(r,{children:"Schweregrad"}),e.jsx(r,{children:"Status"}),e.jsx(r,{className:"text-right",children:"Details"})]})}),e.jsx(Z,{children:N.map(s=>e.jsxs(T,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>P(s),children:[e.jsx(n,{className:"font-mono text-xs",children:z(s.timestamp)}),e.jsx(n,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.userName}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.userRole})]})}),e.jsx(n,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[B(s.action),e.jsx("span",{className:"text-sm",children:w[s.action]||s.action})]})}),e.jsx(n,{children:e.jsx(D,{variant:"outline",children:s.resource})}),e.jsx(n,{children:e.jsx(D,{className:ge[s.severity],variant:"outline",children:s.severity})}),e.jsx(n,{children:e.jsx(D,{className:ve[s.status],variant:"secondary",children:s.status==="success"?"Erfolg":"Fehler"})}),e.jsx(n,{className:"text-right",children:e.jsx(S,{variant:"ghost",size:"sm",children:e.jsx(ie,{className:"h-4 w-4"})})})]},s.id))})]}),N.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(M,{className:"mx-auto h-16 w-16 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Keine ProtokolleintrÃ¤ge gefunden"}),e.jsx("p",{className:"text-muted-foreground",children:"Passen Sie Ihre Filter an oder erweitern Sie den Zeitraum."})]})]})]})]}),t&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold",children:"AktivitÃ¤tsdetails"}),e.jsx("p",{className:"text-muted-foreground",children:z(t.timestamp)})]}),e.jsx(S,{variant:"ghost",onClick:()=>P(null),children:"âœ•"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Benutzer"}),e.jsx("p",{className:"font-medium",children:t.userName}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.userRole})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Aktion"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[B(t.action),e.jsx("span",{children:w[t.action]||t.action})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Details"}),e.jsx("p",{className:"bg-muted p-3 rounded text-sm",children:t.details})]}),t.changes&&t.changes.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Ã„nderungen"}),e.jsx("div",{className:"border rounded overflow-hidden",children:e.jsxs(W,{children:[e.jsx(Q,{children:e.jsxs(T,{children:[e.jsx(r,{children:"Feld"}),e.jsx(r,{children:"Alter Wert"}),e.jsx(r,{children:"Neuer Wert"})]})}),e.jsx(Z,{children:t.changes.map((s,m)=>e.jsxs(T,{children:[e.jsx(n,{className:"font-medium",children:s.field}),e.jsx(n,{className:"font-mono text-sm text-red-600",children:s.oldValue||"(leer)"}),e.jsx(n,{className:"font-mono text-sm text-green-600",children:s.newValue||"(leer)"})]},m))})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"IP-Adresse"}),e.jsx("p",{className:"font-mono",children:t.ipAddress})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"User Agent"}),e.jsx("p",{className:"text-xs break-all",children:t.userAgent})]})]})]})]})})]})}export{Te as default};
