import{as as xe,r as g,a as _,b as B,j as e,B as o,aJ as he,_ as x,C as z,c as S,d as A,q as k,e as T,U as P,h as D,E as me,ay as ue,k as je,ax as ge,aI as E,aA as L,O as pe,I as ve}from"./index-BUxZYuNm.js";import{S as F,a as I,b as R,c as U,d as i}from"./select-Dxhz2xZH.js";import{D as G,a as fe,b as J,c as W,d as X,e as Y}from"./dialog-41pzwtJF.js";import{u as Ne,a as be,F as Z,b as a,c as l,d as t,e as c,f as d,o as we,j as ye,h as Ce,i as Be,s as v}from"./types-R1sowb5b.js";import{S as ee}from"./switch-C0AtMcKJ.js";import{T as ze,a as Se,b as V,c as M}from"./tabs-Bg_j4-QG.js";import{T as Ae,a as ke,b as se,c as m,d as Te,e as u}from"./table-BMiloUPu.js";import"./index-NLfbe9Ak.js";const De=we({email:v().email("Ungültige E-Mail-Adresse"),firstName:v().min(1,"Vorname erforderlich"),lastName:v().min(1,"Nachname erforderlich"),role:Be(["admin","reviewer","user"]),isActive:Ce(),permissions:ye(v()).optional()}),Ee={admin:"bg-red-100 text-red-800 border-red-200",reviewer:"bg-blue-100 text-blue-800 border-blue-200",user:"bg-green-100 text-green-800 border-green-200"},Le={admin:ve,reviewer:pe,user:P},Fe=[{id:"read",label:"Lesen",description:"Daten anzeigen und lesen"},{id:"write",label:"Schreiben",description:"Daten erstellen und bearbeiten"},{id:"delete",label:"Löschen",description:"Daten löschen"},{id:"approve",label:"Genehmigen",description:"Inhalte genehmigen oder ablehnen"},{id:"admin",label:"Administration",description:"Vollzugriff auf alle Funktionen"},{id:"user_management",label:"Benutzerverwaltung",description:"Benutzer verwalten"}];function He(){const{toast:h}=xe(),[q,O]=g.useState(null),[re,f]=g.useState(!1),[ne,p]=g.useState(!1),[j,ie]=g.useState(""),[N,ae]=g.useState("all"),r=Ne({resolver:be(De),defaultValues:{email:"",firstName:"",lastName:"",role:"user",isActive:!0,permissions:["read"]}}),{data:K=[],isLoading:Ie}=_({queryKey:["/api/users"]}),{data:le=[],isLoading:Re}=_({queryKey:["/api/users/activity"]}),b=B({mutationFn:async s=>await L("/api/users","POST",s),onSuccess:()=>{E.invalidateQueries({queryKey:["/api/users"]}),f(!1),r.reset(),h({title:"Benutzer erstellt",description:"Der neue Benutzer wurde erfolgreich erstellt."})},onError:()=>{h({title:"Fehler",description:"Benutzer konnte nicht erstellt werden.",variant:"destructive"})}}),w=B({mutationFn:async({id:s,...n})=>await L(`/api/users/${s}`,"PATCH",n),onSuccess:()=>{E.invalidateQueries({queryKey:["/api/users"]}),p(!1),O(null),r.reset(),h({title:"Benutzer aktualisiert",description:"Die Benutzerdaten wurden erfolgreich aktualisiert."})},onError:()=>{h({title:"Fehler",description:"Benutzer konnte nicht aktualisiert werden.",variant:"destructive"})}}),te=B({mutationFn:async s=>await L(`/api/users/${s}`,"DELETE"),onSuccess:()=>{E.invalidateQueries({queryKey:["/api/users"]}),h({title:"Benutzer gelöscht",description:"Der Benutzer wurde erfolgreich gelöscht."})},onError:()=>{h({title:"Fehler",description:"Benutzer konnte nicht gelöscht werden.",variant:"destructive"})}}),ce=K.filter(s=>{var H,$;const n=j===""||s.email.toLowerCase().includes(j.toLowerCase())||((H=s.firstName)==null?void 0:H.toLowerCase().includes(j.toLowerCase()))||(($=s.lastName)==null?void 0:$.toLowerCase().includes(j.toLowerCase())),C=N==="all"||s.role===N;return n&&C}),y=s=>new Date(s).toLocaleDateString("de-DE",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),de=s=>{O(s),r.reset({email:s.email,firstName:s.firstName||"",lastName:s.lastName||"",role:s.role,isActive:s.isActive,permissions:s.permissions}),p(!0)},Q=s=>{q?w.mutate({...s,id:q.id}):b.mutate(s)},oe=s=>{const n=Le[s]||P;return e.jsx(n,{className:"h-4 w-4"})};return e.jsxs("div",{className:"container mx-auto py-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Benutzerverwaltung"}),e.jsx("p",{className:"text-muted-foreground",children:"Verwalten Sie Benutzer, Rollen und Berechtigungen"})]}),e.jsxs(G,{open:re,onOpenChange:f,children:[e.jsx(fe,{asChild:!0,children:e.jsxs(o,{children:[e.jsx(he,{className:"mr-2 h-4 w-4"}),"Neuer Benutzer"]})}),e.jsxs(J,{className:"max-w-2xl",children:[e.jsxs(W,{children:[e.jsx(X,{children:"Neuen Benutzer erstellen"}),e.jsx(Y,{children:"Erstellen Sie ein neues Benutzerkonto mit entsprechenden Berechtigungen."})]}),e.jsx(Z,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(Q),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(a,{control:r.control,name:"firstName",render:({field:s})=>e.jsxs(l,{children:[e.jsx(t,{children:"Vorname"}),e.jsx(c,{children:e.jsx(x,{...s})}),e.jsx(d,{})]})}),e.jsx(a,{control:r.control,name:"lastName",render:({field:s})=>e.jsxs(l,{children:[e.jsx(t,{children:"Nachname"}),e.jsx(c,{children:e.jsx(x,{...s})}),e.jsx(d,{})]})})]}),e.jsx(a,{control:r.control,name:"email",render:({field:s})=>e.jsxs(l,{children:[e.jsx(t,{children:"E-Mail"}),e.jsx(c,{children:e.jsx(x,{type:"email",...s})}),e.jsx(d,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(a,{control:r.control,name:"role",render:({field:s})=>e.jsxs(l,{children:[e.jsx(t,{children:"Rolle"}),e.jsxs(F,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(c,{children:e.jsx(I,{children:e.jsx(R,{})})}),e.jsxs(U,{children:[e.jsx(i,{value:"user",children:"Benutzer"}),e.jsx(i,{value:"reviewer",children:"Reviewer"}),e.jsx(i,{value:"admin",children:"Administrator"})]})]}),e.jsx(d,{})]})}),e.jsx(a,{control:r.control,name:"isActive",render:({field:s})=>e.jsxs(l,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(t,{className:"text-base",children:"Aktiv"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Benutzer kann sich anmelden"})]}),e.jsx(c,{children:e.jsx(ee,{checked:s.value,onCheckedChange:s.onChange})})]})})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(o,{type:"button",variant:"outline",onClick:()=>f(!1),children:"Abbrechen"}),e.jsx(o,{type:"submit",disabled:b.isPending,children:b.isPending?"Erstelle...":"Erstellen"})]})]})})]})]})]}),e.jsxs(ze,{defaultValue:"users",className:"space-y-6",children:[e.jsxs(Se,{children:[e.jsx(V,{value:"users",children:"Benutzer"}),e.jsx(V,{value:"activity",children:"Aktivitäten"}),e.jsx(V,{value:"permissions",children:"Berechtigungen"})]}),e.jsx(M,{value:"users",children:e.jsxs(z,{children:[e.jsxs(S,{children:[e.jsx(A,{children:"Alle Benutzer"}),e.jsx(k,{children:"Übersicht über alle registrierten Benutzer im System"}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx(x,{placeholder:"Benutzer suchen...",value:j,onChange:s=>ie(s.target.value),className:"max-w-sm"}),e.jsxs(F,{value:N,onValueChange:ae,children:[e.jsx(I,{className:"w-40",children:e.jsx(R,{})}),e.jsxs(U,{children:[e.jsx(i,{value:"all",children:"Alle Rollen"}),e.jsx(i,{value:"admin",children:"Administrator"}),e.jsx(i,{value:"reviewer",children:"Reviewer"}),e.jsx(i,{value:"user",children:"Benutzer"})]})]})]})]}),e.jsx(T,{children:e.jsxs(Ae,{children:[e.jsx(ke,{children:e.jsxs(se,{children:[e.jsx(m,{children:"Benutzer"}),e.jsx(m,{children:"Rolle"}),e.jsx(m,{children:"Status"}),e.jsx(m,{children:"Letzter Login"}),e.jsx(m,{children:"Erstellt"}),e.jsx(m,{className:"text-right",children:"Aktionen"})]})}),e.jsx(Te,{children:ce.map(s=>e.jsxs(se,{children:[e.jsx(u,{children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-muted flex items-center justify-center",children:s.profileImageUrl?e.jsx("img",{src:s.profileImageUrl,alt:`${s.firstName} ${s.lastName}`,className:"w-8 h-8 rounded-full"}):e.jsx(P,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[s.firstName," ",s.lastName]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.email})]})]})}),e.jsx(u,{children:e.jsxs(D,{className:Ee[s.role],variant:"outline",children:[oe(s.role),e.jsx("span",{className:"ml-1 capitalize",children:s.role})]})}),e.jsx(u,{children:e.jsx(D,{variant:s.isActive?"default":"secondary",children:s.isActive?"Aktiv":"Inaktiv"})}),e.jsx(u,{children:s.lastLoginAt?y(s.lastLoginAt):"Nie"}),e.jsx(u,{children:y(s.createdAt)}),e.jsx(u,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>de(s),children:e.jsx(me,{className:"h-4 w-4"})}),e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>te.mutate(s.id),disabled:s.role==="admin",children:e.jsx(ue,{className:"h-4 w-4"})})]})})]},s.id))})]})})]})}),e.jsx(M,{value:"activity",children:e.jsxs(z,{children:[e.jsxs(S,{children:[e.jsx(A,{children:"Benutzeraktivitäten"}),e.jsx(k,{children:"Letzte Aktivitäten und Aktionen der Benutzer"})]}),e.jsx(T,{children:e.jsx("div",{className:"space-y-4",children:le.map(s=>{const n=K.find(C=>C.id===s.userId);return e.jsxs("div",{className:"flex items-center space-x-4 p-4 border rounded-lg",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-muted flex items-center justify-center",children:e.jsx(je,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:s.action}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.details}),e.jsxs("div",{className:"flex items-center space-x-4 text-xs text-muted-foreground mt-1",children:[e.jsxs("span",{children:["Benutzer: ",n==null?void 0:n.firstName," ",n==null?void 0:n.lastName]}),e.jsx("span",{children:"•"}),e.jsx("span",{children:y(s.timestamp)}),s.ipAddress&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsxs("span",{children:["IP: ",s.ipAddress]})]})]})]})]},s.id)})})})]})}),e.jsx(M,{value:"permissions",children:e.jsxs(z,{children:[e.jsxs(S,{children:[e.jsx(A,{children:"Berechtigungen verwalten"}),e.jsx(k,{children:"Übersicht über verfügbare Berechtigungen im System"})]}),e.jsx(T,{children:e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:Fe.map(s=>e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-medium",children:s.label}),e.jsxs(D,{variant:"outline",children:[e.jsx(ge,{className:"h-3 w-3 mr-1"}),s.id]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description})]},s.id))})})]})})]}),e.jsx(G,{open:ne,onOpenChange:p,children:e.jsxs(J,{className:"max-w-2xl",children:[e.jsxs(W,{children:[e.jsx(X,{children:"Benutzer bearbeiten"}),e.jsx(Y,{children:"Bearbeiten Sie die Benutzerdaten und Berechtigungen."})]}),e.jsx(Z,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(Q),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(a,{control:r.control,name:"firstName",render:({field:s})=>e.jsxs(l,{children:[e.jsx(t,{children:"Vorname"}),e.jsx(c,{children:e.jsx(x,{...s})}),e.jsx(d,{})]})}),e.jsx(a,{control:r.control,name:"lastName",render:({field:s})=>e.jsxs(l,{children:[e.jsx(t,{children:"Nachname"}),e.jsx(c,{children:e.jsx(x,{...s})}),e.jsx(d,{})]})})]}),e.jsx(a,{control:r.control,name:"email",render:({field:s})=>e.jsxs(l,{children:[e.jsx(t,{children:"E-Mail"}),e.jsx(c,{children:e.jsx(x,{type:"email",...s})}),e.jsx(d,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(a,{control:r.control,name:"role",render:({field:s})=>e.jsxs(l,{children:[e.jsx(t,{children:"Rolle"}),e.jsxs(F,{onValueChange:s.onChange,value:s.value,children:[e.jsx(c,{children:e.jsx(I,{children:e.jsx(R,{})})}),e.jsxs(U,{children:[e.jsx(i,{value:"user",children:"Benutzer"}),e.jsx(i,{value:"reviewer",children:"Reviewer"}),e.jsx(i,{value:"admin",children:"Administrator"})]})]}),e.jsx(d,{})]})}),e.jsx(a,{control:r.control,name:"isActive",render:({field:s})=>e.jsxs(l,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(t,{className:"text-base",children:"Aktiv"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Benutzer kann sich anmelden"})]}),e.jsx(c,{children:e.jsx(ee,{checked:s.value,onCheckedChange:s.onChange})})]})})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(o,{type:"button",variant:"outline",onClick:()=>p(!1),children:"Abbrechen"}),e.jsx(o,{type:"submit",disabled:w.isPending,children:w.isPending?"Speichere...":"Speichern"})]})]})})]})})]})}export{He as default};
