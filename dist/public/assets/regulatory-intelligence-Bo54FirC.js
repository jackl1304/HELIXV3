import{r as m,u as I,a as ee,b as se,j as e,R as L,B as v,C as x,c as u,d as j,e as h,ah as te,_ as ae,A as W,h as C,ar as B,G as ne,g as le,af as re,am as ie,an as ce,F as M,V as de,f as oe,S as me}from"./index-BUxZYuNm.js";import{S as P,a as R,b as F,c as E,d as r}from"./select-Dxhz2xZH.js";import"./index-NLfbe9Ak.js";function je(){const[g,U]=m.useState(""),[_,O]=m.useState("all"),[S,J]=m.useState("all"),[T,Q]=m.useState("all"),[V,q]=m.useState(null),z=I(),{data:i=[],isLoading:H}=ee({queryKey:["/api/regulatory-updates"]}),d=se({mutationFn:async s=>{const l=await fetch(s?"/api/data-collection/sync-by-type":"/api/data-collection/sync-all",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s?{type:s}:{})});if(!l.ok)throw new Error("Sync failed");return l.json()},onSuccess:()=>{setTimeout(()=>{z.invalidateQueries({queryKey:["/api/regulatory-updates"]})},5e3)}}),D=s=>s.startsWith("fda_")||s.startsWith("ema_")||s.startsWith("mhra_")||s.startsWith("tga_")?"regulatory":s.includes("patent")||s.startsWith("uspto")||s.startsWith("epo")||s.startsWith("wipo")?"patents":s.includes("court")||s.includes("legal")||s.startsWith("pacer")||s.startsWith("bailii")?"legal":s.includes("iso")||s.includes("iec")||s.includes("astm")||s.includes("standards")?"standards":s.includes("safety")||s.includes("recall")||s.includes("rapex")?"safety":"other",k=m.useMemo(()=>i.filter(s=>{var y,N,w,b,f,p;const t=((y=s.title)==null?void 0:y.toLowerCase().includes(g.toLowerCase()))||((N=s.description)==null?void 0:N.toLowerCase().includes(g.toLowerCase()))||((w=s.reference_number)==null?void 0:w.toLowerCase().includes(g.toLowerCase()))||((b=s.source_name)==null?void 0:b.toLowerCase().includes(g.toLowerCase())),a=D(s.source_id),l=_==="all"||a===_,n=S==="all"||s.jurisdiction===S,c=((p=(f=s.metadata)==null?void 0:f.formatted)==null?void 0:p.risk_category)||"Low";return t&&l&&n&&(T==="all"||c===T)}).sort((s,t)=>{const a=new Date(s.published_date||s.created_at||0).getTime();return new Date(t.published_date||t.created_at||0).getTime()-a}),[i,g,_,S,T]),G=m.useMemo(()=>{const s=new Set(i.map(t=>t.jurisdiction).filter(Boolean));return Array.from(s).sort()},[i]),o=m.useMemo(()=>{const s=Date.now(),t=i.filter(n=>{const c=new Date(n.published_date||n.created_at||0).getTime();return s-c<1440*60*1e3}).length,a=i.filter(n=>{const c=new Date(n.published_date||n.created_at||0).getTime();return s-c<10080*60*1e3}).length,l={regulatory:0,patents:0,legal:0,standards:0,safety:0,other:0};return i.forEach(n=>{const c=D(n.source_id);l[c]++}),{total:i.length,last24h:t,last7d:a,byType:l}},[i]),$=s=>{if(!s)return"N/A";const t=new Date(s);return new Intl.DateTimeFormat("de-DE",{year:"numeric",month:"long",day:"numeric"}).format(t)},K=(s,t)=>{const a=new Date(s||t||0);return(new Date().getTime()-a.getTime())/(1e3*60*60*24)<=7},X=s=>{switch(D(s)){case"regulatory":return e.jsx(B,{className:"w-4 h-4"});case"patents":return e.jsx(M,{className:"w-4 h-4"});case"legal":return e.jsx(me,{className:"w-4 h-4"});case"standards":return e.jsx(oe,{className:"w-4 h-4"});case"safety":return e.jsx(de,{className:"w-4 h-4"});default:return e.jsx(W,{className:"w-4 h-4"})}},Y=s=>{const t=D(s);return{regulatory:"Regulatory",patents:"Patent",legal:"Legal",standards:"Standard",safety:"Safety Alert",other:"General"}[t]||"Update"},Z=s=>{switch(s==null?void 0:s.toLowerCase()){case"high":return"destructive";case"medium":return"default";case"low":return"secondary";default:return"outline"}};return H?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx(L,{className:"w-8 h-8 animate-spin mx-auto mb-4"}),e.jsx("p",{children:"Loading regulatory intelligence..."})]})}):e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Regulatory Intelligence"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Comprehensive monitoring across 110+ global data sources"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>d.mutate("regulatory"),disabled:d.isPending,children:[e.jsx(L,{className:`w-4 h-4 mr-2 ${d.isPending?"animate-spin":""}`}),"Sync Regulatory"]}),e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>d.mutate("patents"),disabled:d.isPending,children:[e.jsx(L,{className:`w-4 h-4 mr-2 ${d.isPending?"animate-spin":""}`}),"Sync Patents"]}),e.jsxs(v,{onClick:()=>d.mutate(),disabled:d.isPending,children:[e.jsx(L,{className:`w-4 h-4 mr-2 ${d.isPending?"animate-spin":""}`}),"Sync All Sources"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-auto-fit gap-4",style:{gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))"},children:[e.jsxs(x,{children:[e.jsx(u,{className:"pb-2",children:e.jsx(j,{className:"text-sm font-medium",children:"Total Updates"})}),e.jsxs(h,{children:[e.jsx("div",{className:"text-2xl font-bold",children:o.total}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Across all sources"})]})]}),o.last24h>0&&e.jsxs(x,{children:[e.jsx(u,{className:"pb-2",children:e.jsx(j,{className:"text-sm font-medium",children:"Last 24 Hours"})}),e.jsxs(h,{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:o.last24h}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Recent additions"})]})]}),o.byType.regulatory>0&&e.jsxs(x,{children:[e.jsx(u,{className:"pb-2",children:e.jsx(j,{className:"text-sm font-medium",children:"FDA/EMA Regulatory"})}),e.jsxs(h,{children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:o.byType.regulatory}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"FDA, EMA, Notified Bodies"})]})]}),o.byType.patents>0&&e.jsxs(x,{children:[e.jsx(u,{className:"pb-2",children:e.jsx(j,{className:"text-sm font-medium",children:"USPTO/EPO Patents"})}),e.jsxs(h,{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:o.byType.patents}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"USPTO, EPO, WIPO"})]})]}),o.byType.legal>0&&e.jsxs(x,{children:[e.jsx(u,{className:"pb-2",children:e.jsx(j,{className:"text-sm font-medium",children:"Court Cases"})}),e.jsxs(h,{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:o.byType.legal}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Court decisions"})]})]})]}),e.jsxs(x,{children:[e.jsx(u,{children:e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-5 h-5"}),"Filters & Search"]})}),e.jsxs(h,{className:"space-y-4",children:[e.jsx(ae,{placeholder:"Search by title, reference number, source...",value:g,onChange:s=>U(s.target.value),className:"max-w-md"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Source Type"}),e.jsxs(P,{value:_,onValueChange:O,children:[e.jsx(R,{children:e.jsx(F,{})}),e.jsxs(E,{children:[e.jsx(r,{value:"all",children:"All Types"}),e.jsx(r,{value:"regulatory",children:"Regulatory"}),e.jsx(r,{value:"patents",children:"Patents"}),e.jsx(r,{value:"legal",children:"Legal Cases"}),e.jsx(r,{value:"standards",children:"Standards"}),e.jsx(r,{value:"safety",children:"Safety Alerts"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Jurisdiction"}),e.jsxs(P,{value:S,onValueChange:J,children:[e.jsx(R,{children:e.jsx(F,{})}),e.jsxs(E,{children:[e.jsx(r,{value:"all",children:"All Jurisdictions"}),G.map(s=>s&&e.jsx(r,{value:s,children:s},s))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Risk Level"}),e.jsxs(P,{value:T,onValueChange:Q,children:[e.jsx(R,{children:e.jsx(F,{})}),e.jsxs(E,{children:[e.jsx(r,{value:"all",children:"All Levels"}),e.jsx(r,{value:"High",children:"High"}),e.jsx(r,{value:"Medium",children:"Medium"}),e.jsx(r,{value:"Low",children:"Low"})]})]})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Showing ",k.length," of ",i.length," updates"]})}),k.length===0?e.jsx(x,{children:e.jsxs(h,{className:"py-12 text-center",children:[e.jsx(W,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("p",{className:"text-lg font-medium",children:"No updates found"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Try adjusting your filters or sync new data from sources"})]})}):k.map(s=>{var c,A,y,N,w,b;const t=V===s.id,a=(A=(c=s.metadata)==null?void 0:c.formatted)==null?void 0:A.risk_category,l=((N=(y=s.metadata)==null?void 0:y.formatted)==null?void 0:N.affected_sectors)||[],n=((b=(w=s.metadata)==null?void 0:w.formatted)==null?void 0:b.actionable_insights)||[];return e.jsxs(x,{className:"hover:shadow-md transition-shadow",children:[e.jsx(u,{children:e.jsxs("div",{className:"flex justify-between items-start gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[X(s.source_id),e.jsx(C,{variant:"outline",children:Y(s.source_id)}),K(s.published_date,s.created_at)&&e.jsx(C,{children:"Neu"}),a&&e.jsxs(C,{variant:Z(a),children:[a," Risk"]}),s.reference_number&&e.jsx(C,{variant:"secondary",children:s.reference_number})]}),e.jsx(j,{className:"text-xl mb-2",children:s.title}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1 font-medium text-gray-900",children:[e.jsx(B,{className:"w-4 h-4"}),e.jsx("span",{children:s.source_name||s.source_id})]}),s.published_date&&e.jsxs("div",{className:"flex items-center gap-1 font-medium text-blue-600",children:["ðŸ“… ",new Date(s.published_date).toLocaleDateString("de-DE",{year:"numeric",month:"short",day:"numeric"})]}),s.jurisdiction&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ne,{className:"w-4 h-4"}),e.jsx("span",{children:s.jurisdiction})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(le,{className:"w-4 h-4"}),e.jsx("span",{children:$(s.published_date||s.created_at)})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[s.url&&e.jsx(v,{variant:"outline",size:"sm",onClick:()=>window.open(s.url,"_blank"),children:e.jsx(re,{className:"w-4 h-4"})}),e.jsx(v,{variant:"outline",size:"sm",onClick:()=>q(t?null:s.id),children:t?e.jsx(ie,{className:"w-4 h-4"}):e.jsx(ce,{className:"w-4 h-4"})})]})]})}),e.jsxs(h,{children:[e.jsx("p",{className:"text-sm mb-4",children:s.description}),l.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"Affected Sectors:"}),l.map((f,p)=>e.jsx(C,{variant:"secondary",children:f},p))]}),t&&e.jsxs("div",{className:"mt-4 pt-4 border-t space-y-4",children:[s.full_content&&e.jsxs("div",{className:"prose prose-sm max-w-none",children:[e.jsx("h4",{className:"font-semibold",children:"Technical Details"}),e.jsx("div",{className:"whitespace-pre-wrap text-sm",children:s.full_content})]}),n.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Actionable Insights"}),e.jsx("ul",{className:"list-disc list-inside space-y-1 text-sm",children:n.map((f,p)=>e.jsx("li",{children:f},p))})]}),s.document_type&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(M,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Document Type:"}),e.jsx("span",{children:s.document_type})]})]})]})]},s.id)})]})]})}export{je as default};
