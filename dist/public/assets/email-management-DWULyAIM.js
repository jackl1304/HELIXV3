import{r as v,u as G,a as b,b as f,j as e,K as W,o as K,Q as Z,U as J,C as m,c as u,d as x,q as C,e as h,ax as X,h as P,B as j,E as q,av as A,az as M,l as Y,aA as N,aB as d,a7 as n,_ as c}from"./index-Zh9LXilC.js";import{T as ee}from"./textarea-i5NrZRDI.js";import{S as D}from"./switch-BPOziYjt.js";import{T as se,a as ie,b as T,c as S}from"./tabs-DIpelL6C.js";import{S as ae,a as te,b as re,c as ne,d as o}from"./select-gtWyGZLW.js";import"./index-mrnBHjv1.js";function je(){const[le,de]=v.useState(""),[i,y]=v.useState(null),[z,w]=v.useState(!1),p=G(),{data:R=[],isLoading:Q}=b({queryKey:["/api/email/providers"]}),{data:U=[],isLoading:V}=b({queryKey:["/api/email/templates"]}),{data:B=[],isLoading:I}=b({queryKey:["/api/email/automation-rules"]}),{data:g}=b({queryKey:["/api/email/statistics"]}),E=f({mutationFn:s=>N("/api/email/providers","POST",s),onSuccess:()=>{p.invalidateQueries({queryKey:["/api/email/providers"]}),d({title:"Email-Provider hinzugefügt",description:"Die Konfiguration wurde gespeichert."})}}),k=f({mutationFn:async()=>await N("/api/email/test","POST"),onSuccess:s=>{d({title:"Gmail Test erfolgreich",description:s.emailSent?"Test-Email gesendet und Verbindung bestätigt":"Verbindung erfolgreich getestet"}),p.invalidateQueries({queryKey:["/api/email/providers"]}),p.invalidateQueries({queryKey:["/api/email/statistics"]})},onError:s=>{d({title:"Gmail Test fehlgeschlagen",description:"Bitte überprüfen Sie die Anmeldedaten",variant:"destructive"})}});f({mutationFn:async s=>await N("/api/email/send","POST",s),onSuccess:s=>{d({title:"Email gesendet",description:`Template ${s.template} erfolgreich an ${s.recipient} gesendet`}),p.invalidateQueries({queryKey:["/api/email/statistics"]})},onError:()=>{d({title:"Email-Versand fehlgeschlagen",description:"Bitte versuchen Sie es erneut",variant:"destructive"})}});const F=f({mutationFn:s=>{const a=s.id?"PUT":"POST",r=s.id?`/api/email/templates/${s.id}`:"/api/email/templates";return N(r,a,s)},onSuccess:()=>{p.invalidateQueries({queryKey:["/api/email/templates"]}),w(!1),y(null),d({title:"Template gespeichert",description:"Email-Template wurde aktualisiert."})}}),L=f({mutationFn:({templateId:s,recipients:a})=>{const r={customerName:"Max Mustermann",subscriptionPlan:"Professional",loginUrl:"https://helix-platform.com/dashboard",amount:"899",dueDate:"15.08.2025",invoiceUrl:"https://helix-platform.com/invoice/123",alertTitle:"Neue FDA Guidance",summary:"Wichtige Änderung im Medical Device Approval Prozess",urgency:"medium",dashboardUrl:"https://helix-platform.com/dashboard",updatesCount:12,legalCasesCount:65,expiryDate:"20.08.2025",upgradeUrl:"https://helix-platform.com/upgrade",endDate:"31.08.2025"};return N("/api/email/send","POST",{to:a.split(",")[0].trim(),templateId:s,variables:r})},onSuccess:s=>{d({title:"Test-Email versendet",description:`Template ${s.template} erfolgreich gesendet.`}),p.invalidateQueries({queryKey:["/api/email/statistics"]})},onError:()=>{d({title:"Fehler",description:"Test-Email konnte nicht versendet werden.",variant:"destructive"})}});f({mutationFn:s=>{const a=s.id?"PUT":"POST",r=s.id?`/api/email/automation/${s.id}`:"/api/email/automation";return N(r,a,s)},onSuccess:()=>{p.invalidateQueries({queryKey:["/api/email/automation-rules"]}),d({title:"Automation gespeichert",description:"Email-Automatisierung wurde konfiguriert."})}});const _=()=>{const[s,a]=v.useState({name:"",host:"",port:587,secure:!0,user:"",password:"",dailyLimit:1e3}),r=t=>{t.preventDefault(),E.mutate(s),a({name:"",host:"",port:587,secure:!0,user:"",password:"",dailyLimit:1e3})};return e.jsxs("form",{onSubmit:r,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"name",children:"Provider Name"}),e.jsx(c,{id:"name",value:s.name,onChange:t=>a({...s,name:t.target.value}),placeholder:"SendGrid, Mailgun, SMTP...",required:!0})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"host",children:"SMTP Host"}),e.jsx(c,{id:"host",value:s.host,onChange:t=>a({...s,host:t.target.value}),placeholder:"smtp.sendgrid.net",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"port",children:"Port"}),e.jsx(c,{id:"port",type:"number",value:s.port,onChange:t=>a({...s,port:parseInt(t.target.value)})})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-6",children:[e.jsx(D,{id:"secure",checked:s.secure,onCheckedChange:t=>a({...s,secure:t})}),e.jsx(n,{htmlFor:"secure",children:"SSL/TLS"})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"dailyLimit",children:"Tägliches Limit"}),e.jsx(c,{id:"dailyLimit",type:"number",value:s.dailyLimit,onChange:t=>a({...s,dailyLimit:parseInt(t.target.value)})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"user",children:"Benutzername"}),e.jsx(c,{id:"user",value:s.user,onChange:t=>a({...s,user:t.target.value}),placeholder:"apikey oder email",required:!0})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"password",children:"Passwort/API Key"}),e.jsx(c,{id:"password",type:"password",value:s.password,onChange:t=>a({...s,password:t.target.value}),required:!0})]})]}),e.jsxs(j,{type:"submit",disabled:E.isPending,children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"Provider hinzufügen"]})]})},H=()=>{const[s,a]=v.useState({name:(i==null?void 0:i.name)||"",subject:(i==null?void 0:i.subject)||"",content:(i==null?void 0:i.content)||"",type:(i==null?void 0:i.type)||"custom",isActive:(i==null?void 0:i.isActive)||!0}),[r,t]=v.useState(""),O=()=>{F.mutate({...s,id:i==null?void 0:i.id})},$=()=>{i&&r&&L.mutate({templateId:i.id,recipients:r})};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"templateName",children:"Template Name"}),e.jsx(c,{id:"templateName",value:s.name,onChange:l=>a({...s,name:l.target.value}),placeholder:"Compliance Alert Template"})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"templateType",children:"Typ"}),e.jsxs(ae,{value:s.type,onValueChange:l=>a({...s,type:l}),children:[e.jsx(te,{children:e.jsx(re,{})}),e.jsxs(ne,{children:[e.jsx(o,{value:"customer_onboarding",children:"Kunden Anmeldung"}),e.jsx(o,{value:"customer_offboarding",children:"Kunden Abmeldung"}),e.jsx(o,{value:"billing_reminder",children:"Rechnungserinnerung"}),e.jsx(o,{value:"regulatory_alert",children:"Regulatory Alert"}),e.jsx(o,{value:"weekly_digest",children:"Wöchentlicher Digest"}),e.jsx(o,{value:"trial_expiry",children:"Testphase läuft ab"}),e.jsx(o,{value:"compliance_reminder",children:"Compliance Reminder"}),e.jsx(o,{value:"welcome",children:"Welcome Email"}),e.jsx(o,{value:"custom",children:"Custom"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"subject",children:"Betreff"}),e.jsx(c,{id:"subject",value:s.subject,onChange:l=>a({...s,subject:l.target.value}),placeholder:"{{companyName}} - Neue Regulatory Updates verfügbar"})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"content",children:"Email Content (HTML)"}),e.jsx(ee,{id:"content",value:s.content,onChange:l=>a({...s,content:l.target.value}),rows:10,placeholder:"<h1>Hallo {{customerName}},</h1><p>Neue Updates verfügbar...</p>"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{checked:s.isActive,onCheckedChange:l=>a({...s,isActive:l})}),e.jsx(n,{children:"Template aktiv"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{onClick:O,disabled:F.isPending,children:"Template speichern"}),e.jsxs("div",{className:"flex gap-2 ml-auto",children:[e.jsx(c,{placeholder:"test@example.com, test2@example.com",value:r,onChange:l=>t(l.target.value),className:"w-64"}),e.jsxs(j,{variant:"outline",onClick:$,disabled:!r||L.isPending,children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Test senden"]})]})]})]})};return e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Email-Verwaltung"}),e.jsx("p",{className:"text-muted-foreground",children:"Konfiguration von Email-Providern, Templates und Automatisierungen"})]}),g&&e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:g.emailsSentToday||0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Heute versendet"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:g.activeTemplates||0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Aktive Templates"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:g.automationRules||0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Automationen"})]})]})]}),e.jsxs(se,{defaultValue:"providers",className:"space-y-6",children:[e.jsxs(ie,{className:"grid w-full grid-cols-4",children:[e.jsxs(T,{value:"providers",className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4"}),"Provider"]}),e.jsxs(T,{value:"templates",className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-4 h-4"}),"Templates"]}),e.jsxs(T,{value:"automation",className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4"}),"Automation"]}),e.jsxs(T,{value:"analytics",className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4"}),"Analytics"]})]}),e.jsxs(S,{value:"providers",className:"space-y-6",children:[e.jsxs(m,{children:[e.jsxs(u,{children:[e.jsx(x,{children:"Email-Provider hinzufügen"}),e.jsx(C,{children:"Konfigurieren Sie SMTP-Provider wie SendGrid, Mailgun oder eigene Server"})]}),e.jsx(h,{children:e.jsx(_,{})})]}),e.jsxs(m,{children:[e.jsx(u,{children:e.jsx(x,{children:"Konfigurierte Provider"})}),e.jsx(h,{children:Q?e.jsx("div",{children:"Lade Provider..."}):e.jsx("div",{className:"space-y-4",children:R.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:s.name}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.host,":",s.port," (",s.user,")"]})]})]}),e.jsx(P,{variant:s.status==="active"?"default":"destructive",children:s.status==="active"?"Aktiv":"Fehler"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm font-medium",children:[s.usedToday,"/",s.dailyLimit]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Heute versendet"})]}),e.jsx(j,{variant:"outline",size:"sm",onClick:()=>k.mutate(),disabled:k.isPending,children:"Testen"})]})]},s.id))})})]})]}),e.jsx(S,{value:"templates",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(m,{children:[e.jsxs(u,{children:[e.jsx(x,{children:"Email Templates"}),e.jsx(C,{children:"Verwalten Sie Templates für automatische Benachrichtigungen"})]}),e.jsx(h,{children:V?e.jsx("div",{children:"Lade Templates..."}):e.jsxs("div",{className:"space-y-3",children:[U.map(s=>e.jsx("div",{className:`p-3 border rounded-lg cursor-pointer transition-colors ${(i==null?void 0:i.id)===s.id?"border-blue-500 bg-blue-50":"hover:bg-gray-50"}`,onClick:()=>y(s),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.subject})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{variant:s.isActive?"default":"secondary",children:s.isActive?"Aktiv":"Inaktiv"}),e.jsx(j,{variant:"ghost",size:"sm",onClick:a=>{a.stopPropagation(),y(s),w(!0)},children:e.jsx(q,{className:"w-4 h-4"})})]})]})},s.id)),e.jsxs(j,{variant:"outline",className:"w-full",onClick:()=>{y(null),w(!0)},children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"Neues Template"]})]})})]}),(i||z)&&e.jsxs(m,{children:[e.jsx(u,{children:e.jsx(x,{children:i?"Template bearbeiten":"Neues Template"})}),e.jsx(h,{children:e.jsx(H,{})})]})]})}),e.jsx(S,{value:"automation",className:"space-y-6",children:e.jsxs(m,{children:[e.jsxs(u,{children:[e.jsx(x,{children:"Email-Automatisierung"}),e.jsx(C,{children:"Automatische Email-Versendung basierend auf Ereignissen und Zeitplänen"})]}),e.jsx(h,{children:I?e.jsx("div",{children:"Lade Automation Rules..."}):e.jsxs("div",{className:"space-y-4",children:[B.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:s.name}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Trigger: ",s.trigger," | Frequenz: ",s.frequency]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Nächster Lauf: ",s.nextRun]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{variant:s.isActive?"default":"secondary",children:s.isActive?"Aktiv":"Pausiert"}),e.jsx(j,{variant:"ghost",size:"sm",children:e.jsx(q,{className:"w-4 h-4"})})]})]},s.id)),e.jsxs(j,{variant:"outline",className:"w-full",children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"Neue Automation"]})]})})]})}),e.jsx(S,{value:"analytics",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs(m,{children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:"Emails heute"}),e.jsx(M,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(h,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(g==null?void 0:g.emailsSentToday)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+12% gegenüber gestern"})]})]}),e.jsxs(m,{children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:"Öffnungsrate"}),e.jsx(K,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(h,{children:[e.jsx("div",{className:"text-2xl font-bold",children:"68.2%"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+2.1% gegenüber letzter Woche"})]})]}),e.jsxs(m,{children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:"Klickrate"}),e.jsx(Y,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(h,{children:[e.jsx("div",{className:"text-2xl font-bold",children:"24.8%"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+4.3% gegenüber letzter Woche"})]})]})]})})]})]})}export{je as default};
